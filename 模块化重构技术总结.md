# TextSplitter æ¨¡å—åŒ–é‡æ„æŠ€æœ¯æ€»ç»“

## ğŸ¯ é‡æ„ç›®æ ‡

åŸºäºç”¨æˆ·æå‡ºçš„ä¼˜ç§€æ¶æ„è®¾è®¡å»ºè®®ï¼Œå¯¹TextSplitteræ¨¡å—è¿›è¡Œå…¨é¢çš„æ¨¡å—åŒ–é‡æ„ï¼š

### ğŸ“‹ æ ¸å¿ƒé‡æ„ä»»åŠ¡

1. **ç‹¬ç«‹æ¨¡å—æç‚¼**
   - æå–`ask_gpt`è°ƒç”¨åŠŸèƒ½ä¸ºç‹¬ç«‹çš„`modules/gpt`æ¨¡å—
   - åˆ›å»º`modules/prompts`æç¤ºè¯ç®¡ç†æ¨¡å—

2. **ä¸šåŠ¡æ¨¡å—ä¼˜åŒ–**
   - å°†`text_splitter.py`é‡æ„ä¸º`modules/text_splitter/`ç›®å½•ç»“æ„
   - ä½¿ç”¨ç­–ç•¥æ¨¡å¼ç»Ÿä¸€åˆ†å‰²æ–¹æ¡ˆæ¥å£

## ğŸ—ï¸ é‡æ„æˆæœ

### 1. ç‹¬ç«‹çš„GPTè°ƒç”¨æ¨¡å— (`modules/gpt/`)

```
modules/gpt/
â”œâ”€â”€ __init__.py          # ç»Ÿä¸€çš„GPT APIæ¥å£
â”œâ”€â”€ client.py            # GPTå®¢æˆ·ç«¯æ ¸å¿ƒå®ç°
â”œâ”€â”€ models.py            # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ cache.py             # ç¼“å­˜ç®¡ç†
â””â”€â”€ exceptions.py        # å¼‚å¸¸ç±»å®šä¹‰
```

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… æ”¯æŒå¤šç§APIæä¾›å•†ï¼ˆOpenAIã€DeepSeekã€SiliconFlowç­‰ï¼‰
- âœ… æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è°ƒç”¨
- âœ… å“åº”æ ¼å¼éªŒè¯å’ŒJSONä¿®å¤
- âœ… ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… é…ç½®ç®¡ç†é›†æˆ

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from modules.gpt import create_gpt_client, GPTRequest

# åˆ›å»ºå®¢æˆ·ç«¯
client = create_gpt_client()

# åˆ›å»ºè¯·æ±‚
request = GPTRequest(
    prompt="ä½ å¥½ï¼Œä¸–ç•Œï¼",
    response_type="json",
    log_title="test"
)

# æ‰§è¡Œè°ƒç”¨
response = client.complete(request)
```

### 2. ç»Ÿä¸€çš„æç¤ºè¯ç®¡ç†æ¨¡å— (`modules/prompts/`)

```
modules/prompts/
â”œâ”€â”€ __init__.py          # æç¤ºè¯ç®¡ç†API
â”œâ”€â”€ base.py              # åŸºç¡€æ¨¡æ¿ç±»
â”œâ”€â”€ text_split.py        # æ–‡æœ¬åˆ†å‰²æç¤ºè¯
â”œâ”€â”€ translation.py       # ç¿»è¯‘æç¤ºè¯
â”œâ”€â”€ summary.py           # æ€»ç»“æç¤ºè¯
â””â”€â”€ subtitle_align.py    # å­—å¹•å¯¹é½æç¤ºè¯
```

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… æ¨¡æ¿åŒ–çš„æç¤ºè¯ç®¡ç†
- âœ… å¤šè¯­è¨€æ”¯æŒï¼ˆä¸­æ–‡ã€è‹±æ–‡ç­‰ï¼‰
- âœ… åˆ†ç±»çš„æç¤ºè¯ç”Ÿæˆå™¨
- âœ… çµæ´»çš„å‚æ•°åŒ–é…ç½®
- âœ… ç‰ˆæœ¬åŒ–çš„æç¤ºè¯æ§åˆ¶

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from modules.prompts import get_prompt_manager

# è·å–æç¤ºè¯ç®¡ç†å™¨
prompt_manager = get_prompt_manager()

# è·å–æ–‡æœ¬åˆ†å‰²ç”Ÿæˆå™¨
generator = prompt_manager.get_generator('text_split')

# ç”Ÿæˆæç¤ºè¯
prompt = generator.generate(
    sentence="æµ‹è¯•å¥å­",
    language="zh",
    num_parts=2,
    word_limit=15
)
```

### 3. æ¨¡å—åŒ–çš„æ–‡æœ¬åˆ†å‰²å™¨ (`modules/text_splitter/`)

```
modules/text_splitter/
â”œâ”€â”€ __init__.py          # æ¨¡å—APIå¯¼å‡º
â”œâ”€â”€ core.py              # ä¸»è¦ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ strategies.py        # åˆ†å‰²ç­–ç•¥å®ç°
â”œâ”€â”€ pipeline.py          # ç®¡é“å¤„ç†å™¨
â”œâ”€â”€ processors.py        # æ–‡æœ¬å¤„ç†å·¥å…·
â””â”€â”€ exporters.py         # ç»“æœå¯¼å‡ºå™¨
```

#### 3.1 ç­–ç•¥æ¨¡å¼çš„åˆ†å‰²æ–¹æ¡ˆ (`strategies.py`)

**è®¾è®¡æ¨¡å¼åº”ç”¨ï¼š**
```python
# ç»Ÿä¸€çš„ç­–ç•¥æ¥å£
class SplitStrategy(ABC):
    @abstractmethod
    def split(self, text_list: List[str], **kwargs) -> List[str]:
        pass

# å…·ä½“ç­–ç•¥å®ç°
class PunctuationSplitStrategy(SplitStrategy):
    def split(self, text_list: List[str], **kwargs) -> List[str]:
        # æ ‡ç‚¹ç¬¦å·åˆ†å‰²å®ç°
        pass

class SemanticSplitStrategy(SplitStrategy):
    def split(self, text_list: List[str], **kwargs) -> List[str]:
        # è¯­ä¹‰åˆ†å‰²å®ç°
        pass
```

**å¯ç”¨ç­–ç•¥ï¼š**
- âœ… `PunctuationSplitStrategy` - æ ‡ç‚¹ç¬¦å·åˆ†å‰²
- âœ… `CommaSplitStrategy` - é€—å·æ™ºèƒ½åˆ†å‰²
- âœ… `SemanticSplitStrategy` - GPTè¯­ä¹‰åˆ†å‰²
- âœ… `NLPSplitStrategy` - NLPç»¼åˆåˆ†å‰²

#### 3.2 ç®¡é“å¼å¤„ç†æµç¨‹ (`pipeline.py`)

**ç®¡é“ç‰¹æ€§ï¼š**
- âœ… é“¾å¼ç­–ç•¥æ‰§è¡Œ
- âœ… ä¸­é—´ç»“æœç¼“å­˜
- âœ… åˆ†æ­¥éª¤å¤„ç†æ”¯æŒ
- âœ… é”™è¯¯å¤„ç†å’Œæ¢å¤
- âœ… çµæ´»çš„ç­–ç•¥é…ç½®

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from modules.text_splitter import TextSplitPipeline, PunctuationSplitStrategy

# åˆ›å»ºç®¡é“
pipeline = TextSplitPipeline("output/")

# æ·»åŠ ç­–ç•¥
pipeline.add_strategy(PunctuationSplitStrategy())

# æ‰§è¡Œå¤„ç†
result = pipeline.process(text_list, language='zh')
```

#### 3.3 åŠŸèƒ½æ¨¡å—åŒ–

**æ–‡æœ¬å¤„ç†å™¨ (`processors.py`)ï¼š**
- `TextProcessor` - åŸºç¡€æ–‡æœ¬æ¸…ç†å’Œå¤„ç†
- `SentenceTokenizer` - å¤šè¯­è¨€åˆ†è¯å™¨
- `TextStatistics` - ç»Ÿè®¡åˆ†æå™¨
- `SplitValidator` - åˆ†å‰²ç»“æœéªŒè¯å™¨

**ç»“æœå¯¼å‡ºå™¨ (`exporters.py`)ï¼š**
- æ”¯æŒå¤šç§æ ¼å¼ï¼šTXTã€JSONã€CSVã€Excelã€ç»Ÿè®¡æŠ¥å‘Š
- è‡ªåŠ¨ç»Ÿè®¡åˆ†æ
- æ‰¹é‡å¯¼å‡ºåŠŸèƒ½

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. è®¾è®¡æ¨¡å¼åº”ç”¨

| è®¾è®¡æ¨¡å¼ | åº”ç”¨åœºæ™¯ | æ•ˆæœ |
|---------|---------|------|
| **ç­–ç•¥æ¨¡å¼** | åˆ†å‰²ç­–ç•¥ç»Ÿä¸€æ¥å£ | æ˜“äºæ‰©å±•æ–°çš„åˆ†å‰²æ–¹æ¡ˆ |
| **ç®¡é“æ¨¡å¼** | é“¾å¼å¤„ç†æµç¨‹ | çµæ´»çš„å¤„ç†ç»„åˆ |
| **å·¥å‚æ¨¡å¼** | GPTå®¢æˆ·ç«¯åˆ›å»º | ç»Ÿä¸€çš„åˆ›å»ºæ¥å£ |
| **å•ä¾‹æ¨¡å¼** | å…¨å±€é…ç½®ç®¡ç† | ç»Ÿä¸€çš„é…ç½®è®¿é—® |

### 2. æ¶æ„ä¼˜åŒ–

| ä¼˜åŒ–æ–¹é¢ | å®ç°æ–¹å¼ | æ”¶ç›Š |
|---------|---------|------|
| **ä¾èµ–æ³¨å…¥** | é…ç½®ç®¡ç†å™¨æ³¨å…¥ | é™ä½è€¦åˆåº¦ |
| **æ‡’åŠ è½½** | èµ„æºæŒ‰éœ€åˆå§‹åŒ– | æé«˜å¯åŠ¨é€Ÿåº¦ |
| **é”™è¯¯å¤„ç†** | ä¼˜é›…é™çº§æœºåˆ¶ | æé«˜ç³»ç»Ÿç¨³å®šæ€§ |
| **ç¼“å­˜æœºåˆ¶** | GPTå“åº”ç¼“å­˜ | é¿å…é‡å¤è°ƒç”¨ |

### 3. ä»£ç è´¨é‡æå‡

**æ¨¡å—ç‹¬ç«‹æ€§ï¼š**
- å„æ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•å’Œéƒ¨ç½²
- æ¸…æ™°çš„æ¥å£è¾¹ç•Œ
- æœ€å°åŒ–æ¨¡å—é—´ä¾èµ–

**ä»£ç å¤ç”¨æ€§ï¼š**
- GPTæ¨¡å—å¯è¢«å…¶ä»–ä¸šåŠ¡æ¨¡å—ä½¿ç”¨
- æç¤ºè¯æ¨¡å—æ”¯æŒå¤šç§åº”ç”¨åœºæ™¯
- é€šç”¨çš„æ–‡æœ¬å¤„ç†å·¥å…·

**å¯æ‰©å±•æ€§ï¼š**
- ç­–ç•¥æ¨¡å¼æ”¯æŒæ·»åŠ æ–°çš„åˆ†å‰²æ–¹æ¡ˆ
- ç®¡é“æ¨¡å¼æ”¯æŒçµæ´»çš„å¤„ç†ç»„åˆ
- æ’ä»¶åŒ–çš„æ¶æ„è®¾è®¡

## ğŸ“Š é‡æ„å¯¹æ¯”

### é‡æ„å‰ vs é‡æ„å

| æ–¹é¢ | é‡æ„å‰ | é‡æ„å | æ”¹è¿›æ•ˆæœ |
|------|--------|--------|----------|
| **æ¨¡å—ç»“æ„** | å•ä¸€å¤§æ–‡ä»¶ | åˆ†å±‚æ¨¡å—åŒ–ç›®å½• | ğŸ”¥ å¤§å¹…æå‡ |
| **ä»£ç å¤ç”¨** | åŠŸèƒ½è€¦åˆ | ç‹¬ç«‹å¯å¤ç”¨æ¨¡å— | ğŸ”¥ å¤§å¹…æå‡ |
| **æ‰©å±•æ€§** | ç¡¬ç¼–ç é€»è¾‘ | ç­–ç•¥æ¨¡å¼æ¥å£ | ğŸ”¥ å¤§å¹…æå‡ |
| **å¯ç»´æŠ¤æ€§** | å¤æ‚è€¦åˆ | æ¸…æ™°åˆ†å·¥ | ğŸ”¥ å¤§å¹…æå‡ |
| **æµ‹è¯•æ€§** | éš¾ä»¥å•å…ƒæµ‹è¯• | æ¨¡å—åŒ–æµ‹è¯• | ğŸ”¥ å¤§å¹…æå‡ |
| **é…ç½®ç®¡ç†** | ç¡¬ç¼–ç é…ç½® | ç»Ÿä¸€é…ç½®ç³»ç»Ÿ | âš¡ æ˜¾è‘—æå‡ |
| **é”™è¯¯å¤„ç†** | åŸºç¡€å¼‚å¸¸å¤„ç† | ä¼˜é›…é™çº§ | âš¡ æ˜¾è‘—æå‡ |
| **æ€§èƒ½ä¼˜åŒ–** | é‡å¤è®¡ç®— | ç¼“å­˜æœºåˆ¶ | âš¡ æ˜¾è‘—æå‡ |

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. åŸºç¡€ä½¿ç”¨ï¼ˆå‘åå…¼å®¹ï¼‰

```python
from modules.text_splitter import TextSplitter

# åˆ›å»ºåˆ†å‰²å™¨ï¼ˆä¸ä¹‹å‰å®Œå…¨å…¼å®¹ï¼‰
splitter = TextSplitter(
    language='zh',
    max_split_length=20,
    output_dir="output/"
)

# æ‰§è¡Œå®Œæ•´åˆ†å‰²æµç¨‹
result_file = splitter.process_complete_split(
    enable_comma_split=True,
    enable_semantic_split=False
)
```

### 2. é«˜çº§ä½¿ç”¨ï¼ˆæ–°ç‰¹æ€§ï¼‰

```python
from modules.text_splitter import (
    TextSplitter, 
    PunctuationSplitStrategy,
    SemanticSplitStrategy,
    TextSplitPipeline
)

# è‡ªå®šä¹‰ç­–ç•¥ç»„åˆ
splitter = TextSplitter(language='zh')
splitter.pipeline.strategies.clear()  # æ¸…é™¤é»˜è®¤ç­–ç•¥

# æ·»åŠ è‡ªå®šä¹‰ç­–ç•¥
splitter.add_strategy(PunctuationSplitStrategy())
splitter.add_strategy(SemanticSplitStrategy())

# é…ç½®ç‰¹å®šç­–ç•¥
splitter.configure_strategy('semantic', max_workers=2)

# åˆ†æ­¥éª¤æ‰§è¡Œ
results = splitter.split_text_step_by_step(
    steps=['punctuation', 'semantic']
)

# å¤šæ ¼å¼å¯¼å‡º
splitter.export_results(results['final'], 'json')
```

### 3. ç‹¬ç«‹æ¨¡å—ä½¿ç”¨

```python
# ç‹¬ç«‹ä½¿ç”¨GPTæ¨¡å—
from modules.gpt import create_gpt_client, GPTRequest

client = create_gpt_client()
response = client.complete(GPTRequest("Hello, world!"))

# ç‹¬ç«‹ä½¿ç”¨æç¤ºè¯æ¨¡å—
from modules.prompts import get_prompt_manager

manager = get_prompt_manager()
prompt = manager.get_generator('text_split').generate(
    sentence="æµ‹è¯•",
    language="zh"
)

# ç‹¬ç«‹ä½¿ç”¨ç®¡é“å¤„ç†
from modules.text_splitter import TextSplitPipeline

pipeline = TextSplitPipeline()
pipeline.add_strategy(PunctuationSplitStrategy())
result = pipeline.process(["æµ‹è¯•æ–‡æœ¬"])
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜æœºåˆ¶
- GPTå“åº”ç¼“å­˜ï¼Œé¿å…é‡å¤APIè°ƒç”¨
- ä¸­é—´ç»“æœç¼“å­˜ï¼Œæ”¯æŒæ–­ç‚¹ç»­å¤„ç†
- spaCyæ¨¡å‹æ‡’åŠ è½½ï¼Œæé«˜å¯åŠ¨é€Ÿåº¦

### 2. å¹¶å‘å¤„ç†
- æ”¯æŒå¤šçº¿ç¨‹GPTè°ƒç”¨
- å¼‚æ­¥IOå¤„ç†æ–‡ä»¶æ“ä½œ
- æ‰¹é‡å¤„ç†ä¼˜åŒ–

### 3. å†…å­˜ä¼˜åŒ–
- æµå¼å¤„ç†å¤§æ–‡ä»¶
- åŠæ—¶é‡Šæ”¾ä¸­é—´å˜é‡
- æŒ‰éœ€åŠ è½½é‡å‹èµ„æº

## ğŸ”® æœªæ¥æ‰©å±•

### 1. æ–°åˆ†å‰²ç­–ç•¥
- åŸºäºBERTçš„è¯­ä¹‰åˆ†å‰²
- åŸºäºè§„åˆ™çš„ä¸“ä¸šé¢†åŸŸåˆ†å‰²
- è‡ªé€‚åº”é•¿åº¦åˆ†å‰²ç­–ç•¥

### 2. æ–°å¯¼å‡ºæ ¼å¼
- æ”¯æŒSubRip (.srt) å­—å¹•æ ¼å¼
- æ”¯æŒWebVTT (.vtt) æ ¼å¼
- æ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿å¯¼å‡º

### 3. æ€§èƒ½ä¼˜åŒ–
- GPUåŠ é€Ÿçš„spaCyå¤„ç†
- åˆ†å¸ƒå¼GPTè°ƒç”¨
- æ›´æ™ºèƒ½çš„ç¼“å­˜ç­–ç•¥

## ğŸ’¡ æ€»ç»“

è¿™æ¬¡æ¨¡å—åŒ–é‡æ„æˆåŠŸå®ç°äº†ï¼š

1. **æ¶æ„ç°ä»£åŒ–** - ä»å•ä¸€æ–‡ä»¶å‡çº§ä¸ºæ¨¡å—åŒ–æ¶æ„
2. **åŠŸèƒ½è§£è€¦** - ç‹¬ç«‹çš„GPTã€æç¤ºè¯ã€æ–‡æœ¬åˆ†å‰²æ¨¡å—
3. **è®¾è®¡æ¨¡å¼** - ç­–ç•¥ã€ç®¡é“ã€å·¥å‚ç­‰æ¨¡å¼çš„åˆç†åº”ç”¨
4. **å‘åå…¼å®¹** - ä¿æŒåŸæœ‰APIçš„å®Œå…¨å…¼å®¹æ€§
5. **æ‰©å±•æ€§** - æ”¯æŒè½»æ¾æ·»åŠ æ–°åŠŸèƒ½å’Œåˆ†å‰²ç­–ç•¥

é‡æ„åçš„ä»£ç å…·å¤‡äº†æ›´å¥½çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œä¸ºåç»­åŠŸèƒ½å¼€å‘å¥ å®šäº†åšå®çš„æ¶æ„åŸºç¡€ã€‚åŒæ—¶ï¼Œç‹¬ç«‹çš„GPTå’Œæç¤ºè¯æ¨¡å—å¯ä»¥è¢«é¡¹ç›®ä¸­çš„å…¶ä»–ä¸šåŠ¡æ¨¡å—å¤ç”¨ï¼Œæé«˜äº†æ•´ä½“çš„ä»£ç å¤ç”¨ç‡ã€‚

é€šè¿‡ç­–ç•¥æ¨¡å¼å’Œç®¡é“æ¨¡å¼çš„åº”ç”¨ï¼Œæ–°æ¶æ„èƒ½å¤Ÿçµæ´»åœ°ç»„åˆä¸åŒçš„æ–‡æœ¬åˆ†å‰²æ–¹æ¡ˆï¼Œæ»¡è¶³å¤šæ ·åŒ–çš„ä¸šåŠ¡éœ€æ±‚ã€‚ 